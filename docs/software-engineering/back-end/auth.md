# 사용자 인증

## JWT(JSON Web Token)

- JWT(JSON Web Token)은 JSON 객체에 인증에 필요한 정보들을 담은 후 비밀키로 서명한 토큰으로서 [인터넷 표준 인증 방식(RFC 7519)](https://datatracker.ietf.org/doc/html/rfc7519)임.
    - 공식적으로 인증(Authentication)과 권한허가(Authorization) 방식으로 사용됨.

### JWT 프로세스

1. 사용자가 아이디와 비밀번호 혹은 소셜 로그인을 이용하여 서버에 로그인 요청을 보냄.
2. 서버는 비밀키를 사용하여 JSON 객체를 암호화한 후 JWT 토큰을 발급함.
3. JWT를 헤더에 담아 클라이언트에 보냄.

로그인 이후에는 아래와 같이 활용함.

1. 클라이언트는 JWT를 로컬(쿠키 등)에 저장함.
2. API 요청 할 때마다 `Header`에 JWT를 포함하여 요청한다.
3. 서버는 Header를 매번 확인하여 사용자가 신뢰할만한지 체크하고, 인증이 완료되었다면 API에 대한 응답을 보냄.

사용자가 로그인 이후 사용자에 대한 인증이 완료되었는데 왜 번거롭게 매번 JWT를 Header에 넣어서 요청해야할까?라는 비효율적이라는 생각이 들 수 있음.
하지만 이러한 특성은 HTTP의 특성 때문임.

### HTTP의 특성

- HTTP는 아래와 같은 특성이 있음.
    - Connectionless : 한 번 통신이 이뤄지고 난 후에 연결이 바로 끊어짐.
    - Stateless : 이전 상태를 유지/기억하지 않는다.
- 모든 인터넷 통신은 HTTP 프로토콜을 사용하여 통신함.
- 이러한 특성으로 인해서 귀찮음이 있을 뿐만 아니라 통신이 느려지는 문제가 될 수 있음.
    - 인증된 사용자가 어느 정도 기간동안 재인증을 하지 않아도 되도록(로그인 세션이 유지되도록) 만드는 것이 `Access Token`임.

### JWT의 구조는?

- JWT는 `Header`, `Payload`, `Signature` 3개의 구조로 구성되어 있음.
- **Header**
    - `alg` : Signature에서 사용하는 알고리즘
        - ex) `HS256` or `RS256`
    - `typ` : 토큰 타입
- **Payload** - 사용자 정보의 한 조각인 클레임(claim)이 들어있음.
    - `sub`: 토큰 제목 (subject)
    - `aud`: 토큰 대상자 (audience)
    - `iat`: 토큰이 발급된 시각 (issued at)
    - `exp`: 토큰의 만료 시각 (expired)
- **Signature** - 헤더와 페이로드의 문자열을 합친 후에, 헤더에서 선언한 알고리즘과 key를 이용해 암호한 값
    - Header와 Payload는 단순히 Base64로 인코딩되어 있어 누구나 쉽게 복호화할 수 있지만, Signature는 key가 없으면 복호화할 수 없음.
        - 보안상 안전하다는 특성을 가질 수 있게 되었음.
    - Header에서 선언한 알고리즘에 따라 key는 개인키가 될 수도 있고 비밀키가 될 수도 있음. 
        - 개인키로 서명했다면 공개키로 유효성 검사를 할 수 있음.
        - 비밀키로 서명했다면 비밀키를 가지고 있는 사람만 암호화 및 복호화, 유효성 검사를 할 수 있음.

## Session

## OAuth2

## Passkey